<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>AI on Elari的博客</title><link>https://Elari39.github.io/categories/ai/</link><description>Recent content from Elari的博客</description><generator>Hugo</generator><language>zh-cn</language><managingEditor>majo_elaina@qq.com (Elari39)</managingEditor><webMaster>majo_elaina@qq.com (Elari39)</webMaster><copyright>本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！</copyright><lastBuildDate>Mon, 16 Feb 2026 19:17:00 +0800</lastBuildDate><atom:link href="https://Elari39.github.io/categories/ai/index.xml" rel="self" type="application/rss+xml"/><item><title>在 Hugo 博客中部署 OpenAI 格式的 AI 助手</title><link>https://Elari39.github.io/post/hugoai/</link><pubDate>Mon, 16 Feb 2026 19:17:00 +0800</pubDate><author>majo_elaina@qq.com (Elari39)</author><guid>https://Elari39.github.io/post/hugoai/</guid><description>
<![CDATA[<h1>在 Hugo 博客中部署 OpenAI 格式的 AI 助手</h1><p>作者：Elari39（majo_elaina@qq.com）</p>
        
          <p>在这个 AI 普及的时代，给自己的个人博客添加一个 AI 助手似乎成了一种新的“标配”。不仅可以增加互动性，还能让访客快速了解博客内容或进行闲聊。</p>
<p>本文将详细介绍如何在 Hugo 博客中，利用 Cloudflare Workers 部署一个兼容 OpenAI 接口格式（后端实际可对接 Gemini 等模型）的 AI 聊天插件。</p>
<h2 id="整体架构">
<a class="header-anchor" href="#%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84"></a>
整体架构
</h2><p>由于 Hugo 是静态网站生成器，无法直接在前端安全地调用需要 API Key 的 AI 接口。因此我们需要一个后端服务来中转请求、隐藏 Key 以及处理跨域（CORS）问题。</p>
<ul>
<li><strong>前端</strong>：嵌入在 Hugo 模板中的 HTML/JS，负责 UI 展示、Markdown 渲染和流式数据接收。</li>
<li><strong>后端</strong>：Cloudflare Workers，负责接收前端请求，转发给 AI 提供商（如 Google Gemini），并将结果流式返回。</li>
</ul>
<h2 id="第一步部署-cloudflare-workers">
<a class="header-anchor" href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e9%83%a8%e7%bd%b2-cloudflare-workers"></a>
第一步：部署 Cloudflare Workers
</h2><p>我们使用 Cloudflare Workers 作为 API 网关。它免费、速度快，且支持 Edge Runtime。</p>
<h3 id="worker-代码">
<a class="header-anchor" href="#worker-%e4%bb%a3%e7%a0%81"></a>
Worker 代码
</h3><p>创建一个新的 Worker，并写入以下代码。这段代码主要做了三件事：</p>
<ol>
<li>处理 <code>OPTIONS</code> 预检请求，解决跨域问题。</li>
<li>接收前端的 <code>messages</code> 数组，并可以注入 System Prompt（人设）。</li>
<li>将请求转发给上游 API（如 Gemini 的 OpenAI 兼容接口），并将响应流（Stream）原样透传回前端。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">env</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 允许的来源域名，建议生产环境修改为具体域名
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">ALLOWED_ORIGIN</span> <span class="o">=</span> <span class="s2">&#34;*&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. 处理浏览器的预检请求 (CORS)
</span></span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s2">&#34;OPTIONS&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="o">:</span> <span class="nx">ALLOWED_ORIGIN</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;Access-Control-Allow-Methods&#34;</span><span class="o">:</span> <span class="s2">&#34;POST, OPTIONS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;Access-Control-Allow-Headers&#34;</span><span class="o">:</span> <span class="s2">&#34;Content-Type, Authorization&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span> <span class="o">!==</span> <span class="s2">&#34;POST&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s2">&#34;Method Not Allowed&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">405</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">request</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="c1">// 2. 注入 System Prompt (可选)
</span></span></span><span class="line"><span class="cl">      <span class="c1">// 可以在这里给 AI 设定一个身份，比如“博客助手”
</span></span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">messages</span> <span class="o">&amp;&amp;</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">messages</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">hasSystem</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">m</span> <span class="p">=&gt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">role</span> <span class="o">===</span> <span class="s1">&#39;system&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasSystem</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">body</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">unshift</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">role</span><span class="o">:</span> <span class="s2">&#34;system&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">content</span><span class="o">:</span> <span class="s2">&#34;你是一个运行在 Elari39 博客上的 AI 助手。请用幽默、可爱的语气回答访客的问题。回复请尽量简短。&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">body</span><span class="p">.</span><span class="nx">stream</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// 强制开启流式
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// 从环境变量获取 API 地址和 Key
</span></span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">API_URL</span> <span class="o">=</span> <span class="nx">env</span><span class="p">.</span><span class="nx">GEMINI_API_URL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">API_KEY</span> <span class="o">=</span> <span class="nx">env</span><span class="p">.</span><span class="nx">GEMINI_API_KEY</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">API_URL</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;Content-Type&#34;</span><span class="o">:</span> <span class="s2">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;Authorization&#34;</span><span class="o">:</span> <span class="sb">`Bearer </span><span class="si">${</span><span class="nx">API_KEY</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// 3. 将流直接转发，并强制带上跨域头
</span></span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;Content-Type&#34;</span><span class="o">:</span> <span class="s2">&#34;text/event-stream&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="o">:</span> <span class="nx">ALLOWED_ORIGIN</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;Cache-Control&#34;</span><span class="o">:</span> <span class="s2">&#34;no-cache&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">}),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">status</span><span class="o">:</span> <span class="mi">500</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-Type&#34;</span><span class="o">:</span> <span class="s2">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="o">:</span> <span class="nx">ALLOWED_ORIGIN</span> 
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>记得在 Cloudflare 后台配置环境变量 <code>GEMINI_API_URL</code> 和 <code>GEMINI_API_KEY</code>。</p>
        
        <hr><p>本文2026-02-16首发于<a href='https://Elari39.github.io/'>Elari的博客</a>，最后修改于2026-02-16</p>]]></description><category>Hugo</category><category>AI</category></item></channel></rss>